---
title: "A Comprehensive Guide to DMARC: Ensuring Email Integrity and Trust"
date: "2023-09-11"
spoiler:
  When building a digital project, ensuring your emails land safely and are
  trusted is paramount. But how do you navigate the maze of email security?
  Enter DMARC. Alongside its companions, SPF and DKIM, we delve deep into
  establishing email integrity and combating threats like email spoofing and
  phishing.
tags:
  - security
---

While developing [Voices.ink](https://voices.ink/), a collaborative project with
[@Ester Martí](https://github.com/estermv) that transcribes voice notes into
Notion, I faced a common problem. How could I ensure our transactional emails
reached inboxes rather than spam folders — or worse, prevent attackers from
weaponizing our domain for phishing? My research led me to DMARC.

Email forms the backbone of professional communication, yet its security
vulnerabilities remain startling. Cyber attackers constantly deceive through
email spoofing and phishing. As fraud escalates, robust solutions become
imperative. DMARC — an advanced email protocol — restores trust in our inboxes.

### **Why Do We Need DMARC?**

Email's inherent vulnerabilities enable domain impersonation, where attackers
send emails pretending to be from trusted sources. SPF (Sender Policy Framework)
and DKIM (DomainKeys Identified Mail) counter these threats but remain
imperfect. DMARC (Domain-based Message Authentication, Reporting & Conformance)
fills this gap by leveraging both SPF and DKIM.

### **Understanding DMARC's Significance**

DMARC serves three main purposes:

1. **Authentication**: Ensuring that an email claiming to be from a specific
   domain genuinely originates from that domain.
2. **Reporting**: Enabling domain recipients to report back to the sender about
   DMARC evaluation results, thereby offering insights into potential issues.
3. **Policy Enforcement**: Granting domain owners the power to specify how
   unauthenticated emails should be handled.

![How DMARC Works Diagram](https://media.emailonacid.com/wp-content/uploads/2022/09/How-DMARC-Policy-Works.png)
_Credit: Emailonacid (How DMARC policy works)_

### **The Building Blocks of DMARC: SPF & DKIM**

**SPF** verifies that the email's sending server has the domain owner's
authorization. It uses a specific TXT record in the DNS, like:

`v=spf1 ip4:192.0.2.0/24 ip4:198.51.100.123 a:mail.example.com -all`

This record essentially says, "Only the IP range 192.0.2.0 to 192.0.2.255 and
198.51.100.123 are authorized to send emails for my domain."

**Explanation**:

- `v=spf1`: This indicates the version of SPF being used, which is SPF
  version 1.
- `ip4:192.0.2.0/24`: Authorizes the IP range 192.0.2.0 to 192.0.2.255 to send
  emails for the domain.
- `ip4:198.51.100.123`: Authorizes the specific IP address 198.51.100.123.
- `a:mail.example.com`: Authorizes the IP address resolved from the domain name
  mail.example.com.
- `-all`: Specifies that no other hosts are allowed to send emails. (The '-' is
  a hard fail, meaning emails from other sources should be rejected. `~all`
  would be a soft fail, suggesting they should be accepted but marked.)

**DKIM**, on the other hand, ensures the email's integrity by using
cryptographic signatures. A typical DKIM TXT DNS record might look like:

`v=DKIM1; p=MIGfMA0GCSqG...`

This record holds the public key used by receiving servers to decrypt the
email's DKIM signature and verify its authenticity.

The record's name typically includes a selector prefix, allowing the domain to
have multiple DKIM keys. When sending an email, the server will mention which
selector it's using, guiding the receiving server to the right DNS record.

**Explanation**:

- `v=DKIM1`: This signifies the version of DKIM being used.
- `p=`: This is the public key that receiving servers use to decrypt the DKIM
  signature in the email header. The actual key would be a long string
  (truncated in the example).

### **DMARC in Action**

When DMARC is implemented, domain owners publish a DMARC policy in their TXT DNS
records (using the name `_dmarc`), such as:

`v=DMARC1; p=reject; rua=mailto:reports@example.com; ruf=mailto:forensic@example.com; pct=100; aspf=r; adkim=r`

This record translates to: "If an email fails DMARC authentication, reject it.
And send aggregate DMARC reports to
[reports@example.com](mailto:reports@example.com)."

**Explanation**:

- `v=DMARC1`: Indicates the DMARC version.
- `p=reject`: Policy to apply to emails that fail DMARC. Other values can be
  `none` or `quarantine`.
- `rua=mailto:reports@example.com`: Address where aggregate DMARC reports should
  be sent.
- `ruf=mailto:forensic@example.com`: Address where forensic (detailed) DMARC
  reports should be sent.
- `pct=100`: Percentage of emails to which the DMARC policy should be applied.
- `aspf=r`: SPF alignment mode. 'r' means relaxed (default), while 's' stands
  for strict.
- `adkim=r`: DKIM alignment mode. 'r' is for relaxed, and 's' is for strict.

Once an email is received, the receiving server validates it against SPF and
DKIM. For DMARC to pass, at least one of these, SPF or DKIM, must be valid and
aligned with the claimed domain. Emails failing this check are dealt with
according to the DMARC policy — they might be rejected, quarantined, or let
through with no action.

### **The Takeaway**

Sophisticated phishing attacks make trust paramount in digital communication.
DMARC goes beyond email security — it ensures genuine emails reach recipients
while malicious ones stay blocked. For organizations and individuals alike,
implementing DMARC moves us toward safer digital communication.

When reviewing your email security measures, remember: DMARC is not optional —
it is necessary.

### **Further Resources and Tools**

For deeper exploration of DMARC:

- **DMARC Guide**: A comprehensive guide by the Global Cyber Alliance that
  covers the nuances of DMARC in detail.
  [Check it out here](https://www.globalcyberalliance.org/dmarc/).
- **DMARC Setup Checker**: An invaluable tool provided by the Global Cyber
  Alliance. It not only checks if your DMARC is set up correctly but also offers
  tips on rectifications if needed.
  [Try the tool here](https://dmarcguide.globalcyberalliance.org/#/).
